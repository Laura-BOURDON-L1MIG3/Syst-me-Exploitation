from maxpar import *

def main():
    # Variables globales utilisées pour la communication entre les tâches
    X = None  # Variable partagée entre les tâches
    Y = None  # Variable partagée entre les tâches
    Z = None  # Variable partagée entre les tâches
    N = None  # Variable partagée entre les tâches

    # Fonctions associées pour chaque tâche
    def runT1():
        global X
        X = 1

    def runT2():
        global Y
        Y = 2

    def runT3():
        global N
        N = 5
        
    def runT4():
        global X
        X = Y-2
        
    def runT5():
        global Y
        Y = X+3
        
    def runTsomme():
        global X, Y, Z
        Z = X + Y
        
    # Créer les tâches
    t1 = Task()
    t1.name = "T1"
    t1.writes = ["X"]
    t1.run = runT1

    t2 = Task()
    t2.name = "T2"
    t2.writes = ["Y"]
    t2.run = runT2

    t3 = Task()
    t3.name = "T3"
    t3.writes = ["N"]
    t3.run = runT3

    tSomme = Task()
    tSomme.name = "somme"
    tSomme.reads = ["X","Y"]
    tSomme.writes = ["Z"]
    tSomme.run = runTsomme

    # Créer les systèmes de tâches
    s1 = TaskSystem([t1,t2,t3,tSomme], {"T1": [], "T2": ["T3"], "T3": [], "somme":["T1","T2"]})
    
    # Dépendances de tâches
    #print(s1.getDependencies(t2))

    # Exécuter les tâches séquentiellement
    #s1.runSeq()

    # Exécuter les tâches en parallèle
    #print("\n")
    #s1.run()
    
    # Coût de run() et runSeq()
    #s1.parCost()
    
    ######################
    # Vérifier les entrées du sytème de tâches :
    #s1.rightEntry()
    """
    s2.rightEntry()
    s3.rightEntry()
    s4.rightEntry()"""
    
    ###################### 
    # Graphe du sytème :
    #s1.draw()
    """s2.draw()
    s3.draw()
    s4.draw()"""
    
    # Système déterministe ou non :
    s1.detTestRnd()
    
if __name__ == "__main__":
    main()
